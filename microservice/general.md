# 微服务概览

> 微服务细碎的问题就放在这里讨论

微服务的面试题，大体上可以分成：
1. 微服务本身的面试题。包括微服务的概念，为什么要微服务之类的；
2. 微服务治理的面试题。主要就是服务注册与发现，熔断限流之类的；
3. 微服务架构的面试题。微服务有什么部分，每个部分有什么用处，以及怎么设计；
4. 微服务选型的面试题。包括选择微服务框架，以及选择微服务依赖的第三方中间件的问题；

## 面试题目
### 微服务和 RESTful 的区别

分析：这个东西很多人都聊过，但是很多人都没说清楚。我给个“最终”答案：微服务是一种架构，而 RESTful API 是符合**REST**设计风格的 Web API。所以从这个角度来说，这两者根本不具备可比性。那么为什么面试官要问这个问题呢？大概率是他们公司内部有并存的微服务应用，和 RESTful 应用。

我们先来分析 RESTful，它是一种遵守了**REST**设计风格的 Web API，显然也有不遵守 REST 的。这部分我们一般就是简单描述为 Web 服务。

而微服务，一般是指以 RPC 为通信，结合了整个微服务治理的架构模式。实际上，微服务作为一种架构模式，其落地的选择是有很多的，除了这里说的 RPC，还有一种很重要的实现手段就是基于 Web API 的实现方式。

我们可以总结来说，微服务落地，最基本的通信的角度来说，可以是 RPC，也可以是 HTTP。而在 HTTP 之下，有一个子分类就是 RESTful。因此，微服务和 RESTful 的区别，核心就是：
1. 微服务是架构模式；
2. RESTful 是指符合 REST 规范的 Web API；
3. 微服务可以用 RESTful 来实现；

这里就基本上讨论清楚了，不过我们还可以刷一个亮点：RPC 本身也是可以用 RESTful 来实现的。于是我们可以加上第四点：有些微服务虽然是基于 RPC 来构建的，但是 RPC 本身又可以是用 RESTful 来实现的。

沿着这个思路：
1. 微服务用什么实现？RESTful 或者 RPC 都可以；
2. RPC 用什么实现？直接基于 TCP 或者基于 HTTP 都可以。

答案：
1. 微服务是架构模式；
2. RESTful 是指符合 REST 规范的 Web API；
3. 微服务可以用 RESTful 来实现；
4. （亮点）微服务的另外一种实现，是利用 RPC 来实现；而 RPC 可以直接基于 TCP 来实现，也可以基于 HTTP 来实现，所以也可以用 RESTful 来实现；（这里可能会引起面试官的兴趣，就是问你 RPC 有哪些实现思路）

（最后总结）微服务和 RESTful 总体来说是两种维度的东西。

（这里还有一个可能，就是面试官问你，RPC 和 RESTful 的区别，以为第四点我们聊到了微服务可以是 RPC 也可以是 RESTful）

### RPC 和 RESTful 的区别

分析：RPC 和 RESTful 的区别，前面的问题**微服务和 RESTful 的区别**我们已经提到了。 RPC 名字叫做远程过程调用，是一种远程通信协议。但凡是协议，就会有落地。那么 RPC 的落地就很百花争鸣了，不过主流就是两个流派：基于 HTTP 的和基于 TCP 的。前者的代表是 gRPC，后者的代表是 Dubbo。基于 HTTP 的，如果要是它的 API 设计也符合 REST 设计风格，那么就可以说，它是基于 RESTful 的。

后面我们可以稍微聊一下这两种实现方式的优劣对比，作为一个亮点。

答案：RPC 是远程通信协议，它的实现可以是基于 HTTP 的，也可以是基于 TCP 的。而 RESTful 是符合 REST 设计风格的 Web API。因此，如果一个 RPC 是基于 HTTP 的，并且 HTTP 的 API 设计是符合 REST 设计风格的，那么就可以说这个 RPC 是基于 RESTful 的。

它们也是两个不同维度的东西。一般来说，基于 TCP 的 RPC 实现更加复杂，但是可以从 TCP 层面上优化，因此性能会更好。而基于 HTTP 的则是实现非常简单，目前，基于 HTTP2 协议实现的 RPC 在性能上也很优秀，对于大部分应用来说，并不会触及它的性能上限（这里面是一个很大的误区，有很多人实际中，根本不考虑自己的实际情况，就使劲朝着高性能的角度去选型，其实大多数时候，我们都是和复杂度本身做斗争，而不是和性能作斗争）。

#### 类似问题
- RPC 实现思路。这个其实是一个很复杂的问题，不过只有在面试 RPC 中间件开发的时候才会涉及

### 微服务划分的粒度该如何确定？
分析：微服务划分粒度也可以说是模块划分粒度，其实是一个没准确答案的问题。很多时候，架构师划分模块自己都说不清楚为什么这么划分。

大体上的思路有几种：
- 按照 DDD 理论进行划分：这一类使用 DDD 中的限界上下文(bounded context)作为微服务的边界。也就是一个限界上下文内的自然就是一个微服务
- 按照敏捷团队理论：敏捷强调两个披萨团队，那么微服务的粒度就是一个团队的能力边界
- 按照复杂度理论：一个人能完全理解微服务的细节（或者说模块细节）
- 按照组织架构划分：这个就完全和技术没什么关系了，组织架构怎么设计，然后按照组织架构来分配系统模块

就我个人经验来看，没有哪个人是纯粹按照其中的一条标准来进行划分的。如果有人声称自己是按照 DDD 来划分，那就是在吹牛。因为模块划分，或者说微服务拆分，本身就是一个分蛋糕的过程，这个过程难免伴随组织架构调整。

如果是一个有人事权的 CTO 宣称自己能够按照 DDD 理论来分那还有点可能，不然就都是吹牛。

回答的时候可以回答标准的 DDD 理论思路。

答案：一般来说，微服务的划分可以利用 DDD 理论，一个限界上下文定义了微服务的边界，那么只需要按照限界上下文来进行划分就可以了。

不过那是理想情况。正常来说在真的划分微服务的时候还要考虑：
- 团队规模：微服务的边界不能超出团队的维护能力；
- 复杂度：最好微服务划分到一个人能够完全理解其中细节的地步。或者说，两三个人合在一起能够将服务的细节交代清楚的地步；
- 组织结构：如果不能够调整组织结构，那么组织结构会极大限制微服务划分，也就是康威定律，有什么样的组织架构就有什么样的系统；

一般服务拆分都需要比较强力的实权管理层来推进。

### 既然有了模块化，为什么还要微服务？

### 微服务和 SOA 对比